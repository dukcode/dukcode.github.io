---
layout: single
title: "[CI/CD] (6) ë°°í¬ ìë™í™” - 2"
categories: cicd
tag: [cicd, jenkins, sonarqube, jacoco, checkstyle, github, nginx, blue-green]
toc: true
toc_sticky: true
author_profile: true
sidebar:
  nav: "docs"
header:
  teaser: "https://i.imgur.com/FZxnO2p.png"
# search: false
---

  ğŸ’¡ **CICD ê³¼ì •**ì€ [LINK](https://dukcode.github.io/cicd/cicd-01)ì˜ ê°œìš”ì— ë”°ë¼ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.<br>
  ìˆœì„œë¥¼ ë”°ë¥´ë©´ ìˆœì¡°ë¡­ê²Œ ì§„í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
  {: .notice--info} 

# Jenkinsì—ì„œ Docker Image Build & Pushí•˜ê¸°

![](https://i.imgur.com/FZxnO2p.png)

ì´ì œ `build`ëœ `jar`íŒŒì¼ì„ Docker Imageë¡œ ë§Œë“¤ê³  Docker Hubì— `push`í•´ë³´ì.

Dockerë¥¼ ì‚¬ìš©í•˜ëŠ” ì´ìœ ëŠ” í”„ë¡œì íŠ¸ë¥¼ í•­ìƒ ê°™ì€ í™˜ê²½ì—ì„œ êµ¬ë™í•˜ê¸° ìœ„í•¨ì´ë‹¤. ì¦‰, êµ¬ë™ì— í•„ìš”í•œ ì—¬ëŸ¬ dependencyë¥¼ ì‰½ê²Œ ê´€ë¦¬í•˜ê¸° ìœ„í•¨ì´ë‹¤.

í˜„ì¬ëŠ” `java`ê°€ í”„ë¡œì íŠ¸ì˜ dependencyë¼ê³  ë§í•  ìˆ˜ ìˆë‹¤. ë§Œì•½ ì„œë²„ì— ë‹¤ë¥¸ ë²„ì „ì˜ `java`ê°€ ì„¤ì¹˜ë˜ì–´ ìˆë‹¤ë©´ ì‹¤í–‰ì— ë¬¸ì œê°€ ìƒê¸¸ ìˆ˜ ìˆê¸° ë•Œë¬¸ì— Dockerë¥¼ ì´ìš©í•´ dependencyë¥¼ ì‰½ê²Œ ê´€ë¦¬í•˜ê¸° ìœ„í•¨ì´ë‹¤.

ë˜í•œ Docker Hubë¥¼ ì´ìš©í•˜ëŠ” ì´ìœ ëŠ” ì´ë¯¸ì§€ì˜ ë²„ì „ì„ ì‰½ê²Œ ê´€ë¦¬í•˜ê¸° ìœ„í•¨ì´ë‹¤. ë§Œì•½ ìƒˆë¡œ ë°°í¬í•œ í”„ë¡œì íŠ¸ì— ë¬¸ì œê°€ ìƒê²¼ì„ ë•Œ, Docker Hubì˜ ë²„ì „ê´€ë¦¬ë¥¼ ì´ìš©í•˜ë©´ ì‰½ê²Œ ì´ì „ ë²„ì „ìœ¼ë¡œ ëŒì•„ê°ˆ ìˆ˜ ìˆê²Œëœë‹¤.

ì´ì œ ì—¬ëŸ¬ ì‘ì—…ì„ í•˜ë©° Jenkinsê°€ Docker Imageë¥¼ ë¹Œë“œí•˜ê³  Docker Hubì— `push`í•  ìˆ˜ ìˆë„ë¡ í•´ë³´ì.

## Docker Pipeline Plugin ì„¤ì¹˜

ê°€ì¥ ë¨¼ì € Jenkinsì—ì„œ Docker ëª…ë ¹ì–´ë¥¼ ì‰½ê²Œ ì…ë ¥í•˜ê¸° ìœ„í•´ `Docker Pipeline Plugin`ì„ ì„¤ì¹˜í•´ì£¼ì.

![](https://i.imgur.com/zZ7jd5C.png)

Jenkinsì—ì„œ [Jenkins ê´€ë¦¬] - [í”ŒëŸ¬ê·¸ì¸ ê´€ë¦¬] - [Available Plugins]ì—ì„œ `Docker Pipeline` í”ŒëŸ¬ê·¸ì¸ì„ ì„¤ì¹˜í•´ì¤€ë‹¤.

Docker Pipeline Plugin ê³µì‹ë¬¸ì„œëŠ” [LINK](https://docs.cloudbees.com/docs/admin-resources/latest/plugins/docker-workflow)ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆë‹¤. í•´ë‹¹ í”ŒëŸ¬ê·¸ì¸ì€ Docker ì´ë¯¸ì§€ë¥¼ ë¹Œë“œí•˜ê³ , Docker Registryì— pushí•˜ëŠ” ê²ƒì„ ì§€ì›í•œë‹¤.

## Dockerfile ì‘ì„±

í•´ë‹¹ í”ŒëŸ¬ê·¸ì¸ ê³µì‹ë¬¸ì„œë¥¼ ì‚´í´ë³´ë©´ `Dockerfile`ì„ ê¸°ë°˜ìœ¼ë¡œ ì´ë¯¸ì§€ë¥¼ ë¹Œë“œí•œë‹¤. ë”°ë¼ì„œ `Dockerfile`ì„ ì‘ì„±í•  í•„ìš”ê°€ ìˆë‹¤.

```dockerfile
FROM eclipse-temurin:11.0.18_10-jre-focal

ARG JAR_FILE=build/libs/*.jar

COPY ${JAR_FILE} app.jar

ENV TZ=Asia/Seoul

RUN ln -snf /us/share/zoneinfo/STZ /etc/localtime && echo STZ > /etc/timezone

ENTRYPOINT ["java", "-jar", "/app.jar", "-Duser.timezone=Asia/Seoul"]
```

Dockerfileì˜ ë‚´ìš©ì€ ê°„ë‹¨í•˜ë‹¤. ì›í•˜ëŠ” `java` ë²„ì „ì„ ê¸°ë°˜ìœ¼ë¡œ `build/libs/*.jar`íŒŒì¼ì„ `app.jar`ë¡œ ë³µì‚¬í•œ í›„ timezoneì„¤ì •ì„ ë§ˆì¹˜ê³  `jar`íŒŒì¼ì„ ì‹¤í–‰í•˜ëŠ” ì´ë¯¸ì§€ì´ë‹¤. (ì—¬ê¸°ì„œ `*.jar`ë¡œ íŒŒì¼ì„ ë³µì‚¬í•˜ê¸° ìœ„í•´ bootJar ì„¤ì •ì„ í•˜ì˜€ë‹¤.)

ë‚˜ëŠ” [eclipse-temurin-jre-11](https://hub.docker.com/layers/library/eclipse-temurin/11.0.18_10-jre-focal/images/sha256-6796ce83332a8f6342057197dc3ea9077d0b90189ccc0ac3acbefbba8d7b1583?context=explore)ì´ë¯¸ì§€ë¥¼ ê¸°ë°˜ìœ¼ë¡œ Dockerfileì„ ì‘ì„±í–ˆì§€ë§Œ ì‚¬ìš©í•˜ëŠ” `java` ë²„ì „ì´ ì¡´ì¬í•˜ë©´ Docker Hubì—ì„œ ê²€ìƒ‰í•´ ì‚¬ìš©í•˜ë©´ ëœë‹¤.

í”„ë¡œì íŠ¸ ë£¨íŠ¸ì— í•´ë‹¹ `Dockerfile`ì„ ì‘ì„±í•œë‹¤.

![](https://i.imgur.com/iBMLFM3.png)

## DockerHub ì ‘ì† Credential  ìƒì„±

Docker Hubì— ì´ë¯¸ì§€ë¥¼ ì˜¬ë¦´ ì˜ˆì •ì´ë¯€ë¡œ Docker Hubì— ì ‘ì† ê°€ëŠ¥í•œ Credentialì„ Jenkinsì— ìƒì„±í•œë‹¤. ê·¸ëŸ¬ë©´ stageì—ì„œ credentialì„ ì´ìš©í•´ docker hubì— ì ‘ì†í•´ ì´ë¯¸ì§€ë¥¼ pushí•  ìˆ˜ ìˆë‹¤.

ê°€ì¥ ë¨¼ì € [Docker Hub](https://hub.docker.com/)ì— ê°€ì…í•œë‹¤.

Jenkinsì—ì„œ [Jenkins ê´€ë¦¬] - [Manage Credentials]ì— ì ‘ì†í•œë‹¤. Docker Hub ì ‘ì†ì€ ë‹¤ìŒ í”„ë¡œì íŠ¸ì—ì„œ í•„ìš”í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ Global Credentialë¡œ ìƒì„±í•´ ë³´ê² ë‹¤.

![](https://i.imgur.com/30KKjY5.png)
Systemì— ì ‘ì†í•œë‹¤.

![](https://i.imgur.com/b1b6wzr.png)

`Global credentials`ì— ì ‘ì†í•œë‹¤. [Add Credentials]ë¥¼ ëˆŒëŸ¬ í¬ë ˆë´ì…œì„ ì¶”ê°€í•  ìˆ˜ ìˆë‹¤.

![](https://i.imgur.com/MHZgaJl.png)


ìœ„ì™€ ê°™ì´ docker hub IDì™€ PWë¥¼ ì…ë ¥í•´ì£¼ê³  Credentialì„ ì¶”ê°€í•œë‹¤. ì´ì œ Jenkinsfileì—ì„œ Credentialì˜ IDë¡œ Credentialì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ìˆë‹¤.

## Stage ì‘ì„±

devë¸Œëœì¹˜ì—ì„œ pushê°€ ì¼ì–´ë‚¬ì„ ë•ŒëŠ” `dev-cicd-test`ë¡œ ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œ í•˜ê³  mainë¸Œëœì¹˜ì—ì„œ pushê°€ ì¼ì–´ë‚¬ì„ ë•ŒëŠ” `prod-cicd-test`ë¡œ ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œ í•˜ê³  ì‹¶ë‹¤.

ë”°ë¼ì„œ ë¸Œëœì¹˜ì˜ ì´ë¦„ì— ë”°ë¼ ë³€í•˜ëŠ” ë³€ìˆ˜ë¥¼ ë§Œë“œëŠ” `Set Variables stage`ë¥¼ ì¶”ê°€í•´ ë³´ì. `Set Variables stage`ë¥¼ ì‘ì„±í•´ ë†“ê³  ëª¨ë“  ë³€ìˆ˜ë¥¼ í•´ë‹¹ `stage`ì—ì„œ ê´€ë¦¬í•˜ë©´ ë‹¤ë¥¸ í”„ë¡œì íŠ¸ì— ì ìš© ì‹œì— í•´ë‹¹ `stage`ë§Œ ë³€ê²½í•˜ë©´ ë˜ë¯€ë¡œ ì¬ì‚¬ìš©ì„±ì´ ë†’ì•„ì§„ë‹¤.

Stageë“¤ì˜ ê°€ì¥ ì•ì— ë‹¤ìŒ Stageë¥¼ ì¶”ê°€í•œë‹¤.

```groovy
stage('Set Variables') {  
    steps {  
        echo 'Set Variables'  
        script {  
            // BASIC  
            PROJECT_NAME = 'cicd-test'  
            REPOSITORY_URL = '[ì›ê²© REPOSITORTY URL]'
            PROD_BRANCH = 'main'  
            DEV_BRANCH = 'develop'  
            BRANCH_NAME = env.BRANCH_NAME  
            OPERATION_ENV = BRANCH_NAME.equals(PROD_BRANCH) ? 'prod' : 'dev'  
              
            // DOCKER  
            DOCKER_HUB_URL = 'registry.hub.docker.com'
            DOCKER_HUB_FULL_URL = 'https://' + DOCKER_HUB_URL
            DOCKER_HUB_CREDENTIAL_ID = 'DOCKER_HUB_CREDENTIAL'
            DOCKER_IMAGE_NAME =  OPERATION_ENV + '-' + PROJECT_NAME
        }  
          
    }  
}
```

ìœ„ ì²˜ëŸ¼ ì‘ì„±í•˜ë©´ `DOCKER_IMAGE_NAME`ì— `main` ë¸Œëœì¹˜ ì¼ ë•Œ `prod-cicd-test`, `develop`ë¸Œëœì¹˜ ì¼ë•Œ `dev-cicd-test`ê°€ ë‹´ê¸°ê²Œ ëœë‹¤.

í•˜ëŠ” ê¹€ì— `checkout stage`ì˜ `repository url`ë„ ë³€ìˆ˜ë¡œ ë‹´ì•„ì£¼ì.

```groovy
stage('Git Checkout') {  
    steps {  
        echo 'Checkout Remote Repository'  
        git branch: "${env.BRANCH_NAME}",  
        url: REPOSITORY_URL
    }
}
```

ìœ„ì™€ ê°™ì´ `chekout stage`ë¥¼ ë³€ê²½í•œë‹¤.

ì´ì œ ì‹¤ì œë¡œ `Build & Push Docker Image stage`ë¥¼ ì‘ì„±í•´ë³´ì.

```groovy
stage('Build & Push Docker Image') {  
    steps {  
        echo 'Build & Push Docker Image'  
        withCredentials([usernamePassword(
                credentialsId: DOCKER_HUB_CREDENTIAL_ID,
                usernameVariable: 'DOCKER_HUB_ID',
                passwordVariable: 'DOCKER_HUB_PW')]) {  

            script {  
                docker.withRegistry(DOCKER_HUB_FULL_URL,
                                    DOCKER_HUB_CREDENTIAL_ID) {  
                app = docker.build(DOCKER_HUB_ID + '/' + DOCKER_IMAGE_NAME)  
                app.push(env.BUILD_ID)  
                app.push('latest')  
                }  
            }  
        }    
    }
}
```

ìœ„ì™€ ê°™ì´ ìŠ¤í…Œì´ì§€ë¥¼ ì¶”ê°€í•˜ê³  ì €ì¥í•˜ì.

`withCredentials`ë©”ì„œë“œë¡œ Credentialì˜ ê°’ë“¤ì„ ë³€ìˆ˜ì— ë°›ì„ ìˆ˜ ìˆë‹¤. ë‹¤ë¥¸ ì¶”ê°€ì ì¸ ë°©ë²•ì´ í•„ìš”í•  ì‹œ Docker Pipeline Plugin ê³µì‹ë¬¸ì„œëŠ” [LINK](https://docs.cloudbees.com/docs/admin-resources/latest/plugins/docker-workflow)ë¥¼ ì°¸ê³ í•˜ì—¬ `Jenkinsfile`ì„ ì‘ì„±í•˜ì.

ìœ„ì˜ `stage`ë¥¼ ë³´ë©´ `push`ê°€ ë‘ë²ˆ ì¼ì–´ë‚˜ê²Œ ëœë‹¤. í•˜ë‚˜ëŠ” `latest`ë¡œ ì¼ì–´ë‚˜ê³  í•˜ë‚˜ëŠ” ë¹Œë“œ ë²ˆí˜¸ë¡œ ì¼ì–´ë‚˜ê²Œ ëœë‹¤. ì´ë ‡ê²Œ ë‘ ë²ˆ `push`í•˜ë©´ ë²„ì „ê´€ë¦¬ê°€ ë˜ê³ , ìµœì‹  ë²„ì „ì„ `latest`íƒœê·¸ë¥¼ ì´ìš©í•´ ì‰½ê²Œ ë°›ì•„ì˜¬ ìˆ˜ ìˆê²Œ ëœë‹¤.

ì´ì œ ë³€ê²½ ë‚´ìš©ì„ `push`í•´ë³´ì.

```sh
$ git add .
$ git commit -m "chore: Jenkinsfile Docker Image Build & Push ì¶”ê°€"
$ git push
```

Jenkinsë¥¼ í™•ì¸í•´ ë³´ì.

![](https://i.imgur.com/mkXEgvY.png)

ì¶”ê°€í•œ `stage`ë“¤ì´ ì˜ ì‹¤í–‰ ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

![](https://i.imgur.com/h0IzrQE.png)

ë˜í•œ Docker Hubì— ì ‘ì†í•´ í™•ì¸í•´ ë³´ë©´ `dev-cicd-test`ë¼ëŠ” ì˜ë„í•œ ì´ë¦„ìœ¼ë¡œ Docker Imageê°€ `push`ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

### ìƒì„±ëœ Docker Image ì‚­ì œ

í•˜ì§€ë§Œ ì¡°ê¸ˆì˜ ë¬¸ì œê°€ ìˆë‹¤. Jenkinsì—ì„œ Docker Image Buildê°€ ì—¬ëŸ¬ë²ˆ ì§„í–‰ë˜ë‹¤ ë³´ë©´ ì´ë²ˆ ë²„ì „ì˜ ì´ë¯¸ì§€ê°€ storageì— ê³„ì†í•´ì„œ ë‚¨ì•„ìˆì–´ ìš©ëŸ‰ì„ ì°¨ì§€í•˜ê²Œ ëœë‹¤.

ë§¤ë²ˆ Docker Imagesë“¤ì˜ ëª©ë¡ì„ ê´€ë¦¬í•  ìˆ˜ëŠ” ì—†ê¸°ì— Jenkinsì—ì„œ Docker Image Pushê°€ ì™„ë£Œë˜ê³  ë‚˜ë©´ ì´ì „ íƒœê·¸ì˜ ì´ë¯¸ì§€ë“¤ì€ ì‚­ì œì‹œì¼œì£¼ëŠ” ì‘ì—…ì„ ìë™í™” í•´ë³´ì.


```groovy
stage('Build & Push Docker Image') {  
    steps {  
        echo 'Build & Push Docker Image'  
        withCredentials([usernamePassword(
                credentialsId: DOCKER_HUB_CREDENTIAL_ID,
                usernameVariable: 'DOCKER_HUB_ID',
                passwordVariable: 'DOCKER_HUB_PW')]) {  

            script {  
                docker.withRegistry(DOCKER_HUB_FULL_URL,
                                    DOCKER_HUB_CREDENTIAL_ID) {  
                app = docker.build(DOCKER_HUB_ID + '/' + DOCKER_IMAGE_NAME)  
                app.push(env.BUILD_ID)  
                app.push('latest')  
                }  
            }

            sh(script: """  
                docker rmi \$(docker images -q \
                --filter \"before=${DOCKER_HUB_ID}/${DOCKER_IMAGE_NAME}:latest\" \
                ${DOCKER_HUB_URL}/${DOCKER_HUB_ID}/${DOCKER_IMAGE_NAME})
               """, returnStatus: true)  
            }  
        }    
    }
}
```

ìœ„ì²˜ëŸ¼ ì´ë²ˆ ë¹Œë“œì—ì„œ ë§Œë“¤ì–´ì§„ ì´ë¯¸ì§€ ì´ì „ ì´ë¯¸ì§€ë“¤ì„ ëª¨ë‘ ì‚­ì œí•˜ëŠ” ëª…ë ¹ì–´ë¥¼ stageì— ì¶”ê°€í•´ì¤€ë‹¤. `returnStatus`ëŠ” `true`ë¡œ ì„¤ì •í–ˆëŠ”ë°, ë§Œì•½ ì²« ë¹Œë“œì˜€ë‹¤ë©´ ì´ì „ì˜ ì´ë¯¸ì§€ê°€ ì¡´ì¬í•˜ì§€ ì•Šì•„ `exit 1`ì´ ë¦¬í„´ëœë‹¤. ë”°ë¼ì„œ ì‚­ì œê°€ ì‹¤íŒ¨í•´ë„ ë¬´ì‹œí•˜ê³  `stage`ë¥¼ ì§„í–‰í•˜ê¸° ìœ„í•´ ì¶”ê°€í•œ ì˜µì…˜ì´ë‹¤.

ì´ì œ `push`ë¥¼ ë‹¤ìŒê³¼ ê°™ì´ ì§„í–‰í•œë‹¤.

```sh
$ git add .
$ git commit -m "chore: Jenkinsfile Docker Image ì‚­ì œ ì¶”ê°€"
$ git push
```
.
![](https://i.imgur.com/BRSsr0w.png)

ëª…ë ¹ì–´ ì¶”ê°€ í›„ ë¹Œë“œë¥¼ í•˜ë©´ ì´ì „ íƒœê·¸ì˜ ì´ë¯¸ì§€ë“¤ì€ ì‚­ì œë˜ê³  í˜„ì¬ ë²„ì „ì˜ ì´ë¯¸ì§€ë§Œ ìŠ¤í† ë¦¬ì§€ì— ë‚¨ê²Œëœë‹¤. (ìœ„ì˜ ì‚¬ì§„ì€ ì¶”ê°€ëœ ì˜ˆì‹œì´ë©° ì‹¤ì œë¡œëŠ” `dev-cicd-test`ë¡œ ì´ë¯¸ì§€ ì´ë¦„ì´ ë‚˜ì™€ì•¼ ì •ìƒì…ë‹ˆë‹¤.)

ìœ„ì™€ ê°™ì´ `Jenkinsfile`ì„ ì‘ì„±í–ˆìœ¼ë©´ ì´ì œ ì»¤ë°‹ê³¼ í‘¸ì‹œë¥¼ ì§„í–‰í•˜ì.

```sh
$ git add .
$ git commit -m "chore: Jenkinsfile Docker Image ì‚­ì œ ì¶”ê°€"
$ git push
```

`push`ë¥¼ ì§„í–‰í•˜ê³  Jenkinsë¥¼ í™•ì¸í•˜ë©´ ë¹Œë“œê°€ ì˜ ì§„í–‰ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

![](https://i.imgur.com/zhohizC.png)

ìµœì¢… `Jenkinsfile`ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.

```groovy
pipeline {  
  
    agent any  
  
    environment {  
        GPG_SECRET_KEY = credentials('GPG_SECRET_KEY')  
    }  
  
    stages {  
        stage('Set Variables') {  
            steps {  
                echo 'Set Variables'  
                script {  
                    // BASIC  
                    PROJECT_NAME = 'cicd-test'  
                    REPOSITORY_URL = '[ì›ê²© Repository URL]'  
                    PROD_BRANCH = 'main'  
                    DEV_BRANCH = 'develop'  
                    BRANCH_NAME = env.BRANCH_NAME  
                    OPERATION_ENV = BRANCH_NAME.equals(PROD_BRANCH) ? 'prod' : 'dev'  
  
                    // DOCKER  
                    DOCKER_HUB_URL = 'registry.hub.docker.com'  
                    DOCKER_HUB_FULL_URL = 'https://' + DOCKER_HUB_URL  
                    DOCKER_HUB_CREDENTIAL_ID = 'DOCKER_HUB_CREDENTIAL'  
                    DOCKER_IMAGE_NAME =  OPERATION_ENV + '-' + PROJECT_NAME  
                }  
            }  
        }  
  
        stage('Git Checkout') {  
            steps {  
                echo 'Checkout Remote Repository'  
                git branch: "${env.BRANCH_NAME}",  
                url: REPOSITORY_URL  
            }  
        }  
  
        stage('Git Secret Reveal') {  
            steps {  
                echo 'Git Secret Reveal'  
            sh(script:  
                ('gpg --batch --import ' + GPG_SECRET_KEY + ' && '  
                + ' git secret reveal -f'))  
            }  
        }  
  
        stage('Build') {  
            steps {  
                echo 'Build With gradlew'  
                sh '''  
                    ./gradlew clean build
                '''
            }  
        }  
  
        stage('Build & Push Docker Image') {  
            steps {  
                echo 'Build & Push Docker Image'  
                withCredentials([usernamePassword(  
                        credentialsId: DOCKER_HUB_CREDENTIAL_ID,  
                        usernameVariable: 'DOCKER_HUB_ID',  
                        passwordVariable: 'DOCKER_HUB_PW')]) {  
  
                    script {  
                        docker.withRegistry(DOCKER_HUB_FULL_URL,  
                                            DOCKER_HUB_CREDENTIAL_ID) {  
                        app = docker.build(DOCKER_HUB_ID + '/' + DOCKER_IMAGE_NAME)  
                        app.push(env.BUILD_ID)  
                        app.push('latest')  
                        }  
  
                    sh(script: """  
                        docker rmi \$(docker images -q \  
                        --filter \"before=${DOCKER_HUB_ID}/${DOCKER_IMAGE_NAME}:latest\" \
                        ${DOCKER_HUB_URL}/${DOCKER_HUB_ID}/${DOCKER_IMAGE_NAME})
                    """, returnStatus: true)  
                    }  
                }  
            }  
        }  
  
    }  
}
```

ìµœì¢…ì ìœ¼ë¡œ ì‘ì„±ëœ `Jenkinsfile`ì€ ìœ„ì™€ ê°™ë‹¤.

ì´ì œ Docker Hubì— ì´ë¯¸ì§€ë„ Pushí–ˆìœ¼ë‹ˆ ë‹¤ìŒ í¬ìŠ¤íŠ¸ ì—ì„œëŠ” ì‹¤ì œë¡œ ì„œë²„ì— ì ‘ì†í•´ ë°°í¬ë¥¼ ì§„í–‰í•´ ë³´ì.