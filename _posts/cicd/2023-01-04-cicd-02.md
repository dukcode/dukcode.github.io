---
layout: single
title: "[CI/CD] (2) Jenkins ì„¤ì¹˜í•˜ê³  ì‹¤í–‰í•´ë³´ê¸°"
categories: cicd
tag: [cicd, jenkins, sonarqube, jacoco, checkstyle, github, nginx, blue-green]
toc: true
toc_sticky: true
author_profile: true
sidebar:
  nav: "docs"
header:
  teaser: "https://i.imgur.com/p4WgI3H.png"
# search: false
---

  ğŸ’¡ **CICD ê³¼ì •**ì€ [LINK](https://dukcode.github.io/cicd-01)ì˜ ê°œìš”ì— ë”°ë¼ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.<br>
  ìˆœì„œë¥¼ ë”°ë¥´ë©´ ìˆœì¡°ë¡­ê²Œ ì§„í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
  {: .notice--info} 

# Jenkins ì„¤ì¹˜ ë° ì‹¤í–‰

![](https://i.imgur.com/p4WgI3H.png)

Jenkinsë€ ì½”ë“œì— ëŒ€í•œ **ì§€ì†ì  í†µí•©(CI)**ê³¼ **ì§€ì†ì  ë°°í¬(CD)** ë¥¼ ì§€ì›í•˜ê¸° ìœ„í•œ ë„êµ¬ì´ë‹¤. ì¦‰, ì»´íŒŒì¼ ì˜¤ë¥˜ë¥¼ ê²€ì¶œí•˜ê³ , ìë™í™”ëœ í…ŒìŠ¤íŠ¸ë¥¼ ìˆ˜í–‰í•˜ë©°, ì •ì  ì½”ë“œ ë¶„ì„ì„ ì œê³µí•˜ê³ , ì„±ëŠ¥ ë³€í™”ë„ ê°ì‹œí•  ìˆ˜ ìˆë‹¤. ë˜í•œ, ì§€ì†ì ì¸ ë°°í¬ë¥¼ ê°€ëŠ¥í•˜ê²Œ í•´ì¤€ë‹¤.

**í•œë§ˆë””ë¡œ ì •ë¦¬í•˜ë©´ JenkinsëŠ” ì†ŒìŠ¤ì½”ë“œë¥¼ ì‘ì„±í•˜ê³  ì¶œì‹œí•˜ê¸° ê¹Œì§€ì˜ ëª¨ë“  ì‘ì—…ì„ ìë™í™” í•´ì¤„ ìˆ˜ ìˆëŠ” íˆ´ì´ë‹¤.**

ë¬¼ë¡  ìë™í™”ë¥¼ êµ¬ì¶•í•˜ëŠ” ì¼ì€ ê·¸ë ‡ê²Œ ì‰¬ìš´ ì¼ì€ ì•„ë‹ˆë‹¤. í•´ë‹¹ í¬ìŠ¤íŠ¸ ì‹œë¦¬ì¦ˆë¥¼ ë³´ë©° ì°¨ê·¼ì°¨ê·¼ ë”°ë¼í•  ìˆ˜ ìˆë„ë¡ ì‘ì„±í•´ ë³´ê² ë‹¤.

ì´ë²ˆ í¬ìŠ¤íŠ¸ì—ì„œëŠ” Dockerë¥¼ í†µí•´ Jenkinsë¥¼ ì„¤ì¹˜í•˜ê³  ì‹¤í–‰ê¹Œì§€ ì§„í–‰í•´ ë³´ì.

## Docker ì„¤ì¹˜

ê°œìš”ì—ì„œ ë§í–ˆë“¯ì´ ì‹¤ì œ í™˜ê²½ì—ì„œëŠ” Jenkins ì„œë²„ë¥¼ ë”°ë¡œ ë‘ì§€ë§Œ, ìš°ë¦¬ëŠ” CICDë¥¼ ì—°ìŠµí•˜ê¸° ìœ„í•œ ê²ƒì´ë‹ˆ Localì— Jenkinsë¥¼ ì„¤ì¹˜í•˜ë„ë¡ í•˜ê² ë‹¤. Jenkins ì „ìš© ì„œë²„ë¥¼ ë‘˜ ì—¬ìœ ê°€ ìˆë‹¤ë©´ ê·¸ ê³³ì—ì„œ ì§„í–‰í•˜ë©´ ëœë‹¤.

Local ì»´í“¨í„°ë¡œ `macOS`ë¥¼ ì‚¬ìš©í•˜ê³  ìˆë‹¤. ë”°ë¼ì„œ `Docker Desktop`ì„ ë‹¤ìŒê³¼ ê°™ì€ ëª…ë ¹ì–´ë¡œ ì„¤ì¹˜í•´ ì¤€ë‹¤.

> `Docker Engine`ì€ ë¦¬ëˆ…ìŠ¤ì—ì„œë§Œ êµ¬ë™ëœë‹¤. ìœˆë„ìš°ë‚˜ ë§¥ì—ì„œ `Docker Engine`ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” ë¦¬ëˆ…ìŠ¤ ê°€ìƒ ë¨¸ì‹ ì„ ì„¤ì¹˜í•˜ê³  ì„¸íŒ…í•˜ëŠ” ë³µì¡í•œ ê³¼ì •ì´ í•„ìš”í•˜ë‹¤. ì´ëŸ° ê·€ì°®ì€ ê³¼ì •ì„ í•œë²ˆì— í•´ê²°í•´ì£¼ëŠ” `Docker Desktop`ì„ ì„¤ì¹˜í–ˆë‹¤. **ì„¤ì¹˜í•˜ê³ ì í•˜ëŠ” OSê°€ ë¦¬ëˆ…ìŠ¤ì¸ ê²½ìš°, [LINK](https://docs.docker.com/engine/install/)ì—ì„œ ìš´ì˜ì²´ì œì— ë§ê²Œ docker engineì„ ì„¤ì¹˜í•˜ë©´ ëœë‹¤.**

```sh
$ brew install --cask docker
```

ìœ„ì˜ ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•˜ë©´ ì•„ë˜ì™€ ê°™ì´ ì„¤ì¹˜ê°€ ì§„í–‰ëœë‹¤.

![](https://i.imgur.com/v9ehF0w.png){:.align-center}

ë‹¤ìŒ ëª…ë ¹ì–´ë¡œ `Docker`ê°€ ì˜ ì„¤ì¹˜ ë˜ì—ˆëŠ”ì§€ í™•ì¸í•´ë³´ì.

```sh
$ docker --version
```

ì•„ë˜ì™€ ê°™ì´ ì‘ì„±ì¼ ê¸°ì¤€ `20.10.21`ë²„ì „ì´ ì˜ ì„¤ì¹˜ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

![](https://i.imgur.com/E4B5WMU.png){:.align-center}

ì´ë¡œì¨ ê°„ë‹¨í•˜ê²Œ Docker ì„¤ì¹˜ë¥¼ ë§ˆì³¤ë‹¤.

## Jenkins Container ì‹¤í–‰

Docker Containerë¥¼ ì´ìš©í•´ `Jenkins`ë¥¼ ì‹¤í–‰ ì‹œí‚¬ ê²ƒì´ë‹¤.

ê°€ì¥ ë¨¼ì €, Jenkinsì˜ ê³µì‹ ì´ë¯¸ì§€ë¥¼ `pull`í•˜ê³  í•„ìš”í•œ ì„¤ì •ì„ í•œ ë’¤ ì»¨í…Œì´ë„ˆë¥¼ ë„ìš°ë©´ ëœë‹¤. ì—¬ëŸ¬ê°€ì§€ í•´ì£¼ì–´ì•¼ í•˜ëŠ” ì„¤ì •ì„ ìƒëµí•˜ê¸° ìœ„í•´ `Dockerfile`ì„ ì‘ì„±í•  ìˆ˜ ìˆì§€ë§Œ, í˜„ì¬ëŠ” ì—°ìŠµí•˜ëŠ” ê³¼ì •ì´ê¸° ë•Œë¬¸ì— ì§ì ‘ í•´ë³´ê³  ì¶”í›„ `Dockerfile`ì„ ì‘ì„±í•´ ì‰½ê²Œ Jenkins Containerë¥¼ ë„ì›Œë³´ì.

### Docker ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ

ë‹¤ìŒ ëª…ë ¹ì–´ë¡œ Docker Hubì—ì„œ `Jenkins`ì˜ [ê³µì‹ ì´ë¯¸ì§€](https://hub.docker.com/r/jenkins/jenkins)ë¥¼ `pull`í•´ì¤€ë‹¤.

```sh
$ docker pull jenkins/jenkins
```

ê·¸ëŸ¬ë©´ ë‹¤ìŒê³¼ ê°™ì€ ì˜¤ë¥˜ê°€ ìƒê¸¸ ìˆ˜ ìˆë‹¤.

```sh
$ docker pull jenkins/jenkins                                                                                                                                               
Using default tag: latest
Cannot connect to the Docker daemon at unix:///var/run/docker.sock. Is the docker daemon running?
```

docker deamonì´ ì‹¤í–‰ë˜ê³  ìˆì§€ ì•Šë‹¤ëŠ” ì˜ë¯¸ì´ë‹¤. docker desktopì„ ì‹¤í–‰ì‹œì¼œ deamonì„ ì‹¤í–‰ìƒíƒœë¡œ ë§Œë“¤ì–´ ì£¼ì.

![](https://i.imgur.com/LqdQk7h.png){:.align-center}

docker desktopì„ ë„ìš°ê³  ë‹¤ìŒê³¼ ê°™ì€ í™”ë©´ì´ ë³´ì´ë©´ docker deamonì´ ì‹¤í–‰ë˜ê³  ìˆëŠ” ìƒíƒœì´ë‹¤. ë‹¤ì‹œ ìœ„ì˜ ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì´ docker imageë¥¼ ë°›ì•„ì˜¬ ìˆ˜ ìˆë‹¤.

```sh
$ docker pull jenkins/jenkins

Using default tag: latest
latest: Pulling from jenkins/jenkins
c3e6129b48b6: Pull complete
a0408b343c56: Pull complete
77aecf6dd9e0: Pull complete
d60176504adc: Pull complete
011eff629313: Pull complete
fbf087153ea6: Pull complete
918364f83914: Pull complete
6e83ec4026ce: Pull complete
5fee921d4688: Pull complete
994bab7b70d4: Pull complete
99515d9d6eca: Pull complete
a6abb55c90a4: Pull complete
359a3c3ca1df: Pull complete
Digest: sha256:055adadf1544ca40ffa4d771a8741fc17074fbb492dc261d4e48905bc5c401ba
Status: Downloaded newer image for jenkins/jenkins:latest
docker.io/jenkins/jenkins:latest

```

### Jenkins Container ì‹¤í–‰

```sh
$ mkdir ~/docker
$ sudo docker run -d \
-p 8090:8080 \
-v ~/docker/jenkins:/var/jenkins_home \
-v /var/run/docker.sock:/var/run/docker.sock \
--name jenkins \
-u root \
jenkins/jenkins
```

- **-d** : ì»¨í…Œì´ë„ˆë¥¼ ë°ëª¬(ë°±ê·¸ë¼ìš´ë“œ)ìœ¼ë¡œ ë„ìš´ë‹¤.

- **-p 8090:8080** : ì»¨í…Œì´ë„ˆ ì™¸ë¶€ì™€ ë‚´ë¶€ í¬íŠ¸ë¥¼ í¬ì›Œë”©í•œë‹¤. Jenkinsì˜ ê¸°ë³¸ í¬íŠ¸ëŠ” 8080ì´ë‹¤. ì»¨í…Œì´ë„ˆì˜ 8080 í¬íŠ¸ë¥¼ í˜¸ìŠ¤íŠ¸ì˜ 8090í¬íŠ¸ë¥¼ í¬ì›Œë”©í•œë‹¤. ì¶”í›„ ì‘ì„±í•  Spring Projectì˜ ê¸°ë³¸ í¬íŠ¸ë„ 8080ì´ê¸° ë•Œë¬¸ì— ê²¹ì¹˜ì§€ ì•Šê²Œ í•˜ê¸° ìœ„í•´ ì™¸ë¶€í¬íŠ¸ë¥¼ 8090ìœ¼ë¡œ ë³€ê²½í•´ ì£¼ì—ˆë‹¤. ê·¸ëŸ¬ë©´ `http://localhost:8090`ìœ¼ë¡œ Jenkinsì— ì ‘ì†í•  ìˆ˜ ìˆë‹¤.

- **-v ~/docker/jenkins:/var/jenkins_home** : ë„ì»¤ ì»¨í…Œì´ë„ˆì˜ ë°ì´í„°ëŠ” ì»¨í…Œì´ë„ˆê°€ ì¢…ë£Œë˜ë©´ íœ˜ë°œëœë‹¤. ë”°ë¼ì„œ í˜¸ìŠ¤íŠ¸ì˜ ë³¼ë¥¨ì„ ë§ˆìš´íŠ¸ í•˜ë©´ ì»¨í…Œì´ë„ˆê°€ ì¢…ë£Œë˜ì–´ë„ í•´ë‹¹ ë°ì´í„°ë¥¼ ë³´ì¡´í•  ìˆ˜ ìˆë‹¤. ì¦‰, ì  í‚¨ìŠ¤ ì»¨í…Œì´ë„ˆì˜ `/var/jenkin_home` ë””ë ‰í„°ë¦¬ë¥¼ ë¡œì»¬ì˜ `~/docker/jenkins` ë””ë ‰í† ë¦¬ì— ë§ˆìš´íŠ¸í•˜ê³  ë°ì´í„°ë¥¼ ë³´ì¡´í•œë‹¤.

- **-v /var/run/docker.sock:/var/run/docker.sock** : í˜¸ìŠ¤íŠ¸ì˜ docker socketì„ ë¹Œë ¤ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. ì†Œì¼“ í†µì‹ ì„ í†µí•´ ì—ì´ì „íŠ¸ì»¨í…Œì´ë„ˆëŠ” í˜¸ìŠ¤íŠ¸ì˜ daemonì— docker ëª…ë ¹ì„ ì „ë‹¬í•œë‹¤. ì´ ë°©ì‹ì€ `DooD(Docker Out Of Docker)`ë¡œ ë¶ˆë¦¬ë©° Dockerì¸¡ì—ì„œ `DinD(Docker in Docker)`ë³´ë‹¤ ê¶Œì¥í•˜ëŠ” ë°©ì‹ì´ë‹¤. ì¦‰, í•´ë‹¹ ì˜µì…˜ìœ¼ë¡œ Jenkins ì»¨í…Œì´ë„ˆ ë‚´ì—ì„œë„ Dockerë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆë‹¤.

-  **--name jenkins**Â : ë„ì»¤ ì»¨í…Œì´ë„ˆì˜ ì´ë¦„ì„ ì„¤ì •í•œë‹¤.

-   **-u root**Â : ì»¨í…Œì´ë„ˆê°€ ì‹¤í–‰ë  ë¦¬ëˆ…ìŠ¤ì˜ ì‚¬ìš©ì ê³„ì •ì„ root ë¡œ ëª…ì‹œí•œë‹¤.

#### docker-ce-cli ì„¤ì¹˜

Jenkins Containerê°€ Docker Socketì— ì—°ê²°ë˜ì–´ìˆì§€ë§Œ Docker ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ë ¤ë¨¼ ì—°ê²°ëœ Docker Engineì— ëª…ë ¹ì„ ë‚´ë¦´ ìˆ˜ ìˆëŠ” `docker-ce-cli`ë¥¼ ì„¤ì¹˜í•´ì•¼í•œë‹¤.

ë‹¤ìŒê³¼ ê°™ì€ ëª…ë ¹ì–´ë¡œ Jenkins Containerì— ì§ì ‘ ì ‘ì†í•´ `docker-ce-cli`ë¥¼ ì„¤ì¹˜í•˜ì

```sh
# jenkins bash ì ‘ì†
$ docker exec -it jenkins /bin/bash

# jenkins container ë‚´ë¶€ì—ì„œ
$ apt-get update
$ apt-get install \
    ca-certificates \
    curl \
    gnupg \
    lsb-release
$ mkdir -p /etc/apt/keyrings
$ curl -fsSL https://download.docker.com/linux/debian/gpg | gpg --dearmor -o /etc/apt/keyrings/docker.gpg 
$ echo \
  "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/debian \
  $(lsb_release -cs) stable" | tee /etc/apt/sources.list.d/docker.list > /dev/null
$ apt-get update
$ apt-get install docker-ce-cli

$ exit
```

ì´ì œ Jenkins Container ì•ˆì— `docker-ce-cli`ê°€ ì„¤ì¹˜ë˜ì—ˆë‹¤. í•˜ì§€ë§Œ ì§ì ‘ `bash`ì— ì ‘ì†í•´ `docker-ce-cli`ë¥¼ ì„¤ì¹˜í•˜ë©´ Jenkins Containerë¥¼ ì¢…ë£Œí•˜ë©´ ì„¤ì¹˜ëœ docker-ce-cliê°€ ê°™ì´ ì‚­ì œë˜ì–´, ë‹¤ì‹œ Jenkins Containerë¥¼ ë‹¤ì‹œ ì¼°ì„ ë•Œ ì¬ì„¤ì¹˜ê°€ í•„ìš”í•˜ë‹¤.

ì´ë¥¼ ë°©ì§€í•˜ê¸°ìœ„í•´ Dockerfileì„ êµ¬ì„±í•´ Jenkins Containerê°€ ì‹œì‘ë  ë•Œ ìë™ì ìœ¼ë¡œ docker-ce-cliê°€ ì„¤ì¹˜ë˜ê²Œ í•  ìˆ˜ ìˆë‹¤. í•˜ì§€ë§Œ ì´ë²ˆ í¬ìŠ¤íŠ¸ì—ì„œëŠ” í…ŒìŠ¤íŠ¸ìš© ì»¨í…Œì´ë„ˆì´ê¸° ë•Œë¬¸ì— `Dockerfile`ì„ ë”°ë¡œ êµ¬ì„±í•˜ì§€ëŠ” ì•Šê² ë‹¤.

### Jenkins ì ‘ì†

ìœ„ì˜ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ê³  ë¸Œë¼ìš°ì €ë¡œ `http://localhost:8090`ìœ¼ë¡œ ì ‘ì†í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì´ Jenkinsë¥¼ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

![](https://i.imgur.com/VOq9SJr.png){:.align-center}

ì´ˆê¸° ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì•¼ í•˜ëŠ”ë°, ì´ˆê¸° ë¹„ë°€ë²ˆí˜¸ë¥¼ í™•ì¸í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì€ ë‘ê°€ì§€ ë°©ë²•ì´ ìˆë‹¤.

- docker logsë¡œ í™•ì¸
- ì§ì ‘ `/var/jenkins_home/secrets/initialAdminPassword`ì— ì ‘ê·¼í•´ì„œ í™•ì¸

ë¨¼ì € docker logsë¡œ í™•ì¸í•´ ë³´ì. ë‹¤ìŒê³¼ ê°™ì€ ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•˜ë©´ ìˆ˜ë§ì€ ë³„ ì‚¬ì´ì— ì´ˆê¸° ë¹„ë°€ë²ˆí˜¸ë¥¼ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

```sh
$ docker logs jenkins
```

![](https://i.imgur.com/DtzlEEE.png)

ë‹¤ìŒì€ `/var/jenkins_home/secrets/initialAdminPassword`ì— ì§ì ‘ ì ‘ê·¼í•´ í™•ì¸í•´ ë³´ì. `/var/jenkins_home`ì„ `~/docker/jenkins`ì— ë§¤í•‘í•´ë†“ì•˜ê¸° ë•Œë¬¸ì— ë‹¤ìŒê³¼ ê°™ì€ ëª…ë ¹ì–´ë¡œ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

```sh
$ cat ~/docker/jenkins/secrets/iniitalAdminPassword
```

ìœ„ì—ì„œ ì–»ì€ ì´ˆê¸° ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ í™”ë©´ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

![](https://i.imgur.com/KHNxNSH.png){:.align-center}

íŠ¹ë³„í•˜ê²Œ ì„¤ì¹˜í•  í”ŒëŸ¬ê·¸ì¸ì´ ì—†ìœ¼ë©´ ì™¼ìª½ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì¶”ì²œëœ í”ŒëŸ¬ê·¸ì¸ì„ ì„¤ì¹˜í•˜ì.

![](https://i.imgur.com/G7MsASy.png){:.align-center}

í”ŒëŸ¬ê·¸ì¸ ì„¤ì¹˜ê°€ ì™„ë£Œë˜ê³  ì ‘ì†í•  admin ê³„ì •ì„ ìƒì„±í•œë‹¤.

![](https://i.imgur.com/Drjh5oi.png)

Jenkins Instance Configuraionì„ ì„¤ì •í•œë‹¤. Jenkins Resourceì—ì„œ ì ˆëŒ€ê°’ìœ¼ë¡œ ì‚¬ìš©í•  URL ê°’ì„ ì„¤ì •í•˜ëŠ” ë‹¨ê³„ì´ë‹¤.

ì™¸ë¶€ì—ì„œ ì ‘ì†í•  ìˆ˜ ìˆëŠ” URLì„ ì…ë ¥í•˜ëŠ” ê²ƒì´ ê¶Œì¥ëœë‹¤. ì´ë¯¸ì§€ëŠ” `http://localhost:8090`ìœ¼ë¡œ ë˜ì–´ ìˆì§€ë§Œ, ì™¸ë¶€ì—ì„œ ì ‘ì†í•  ìˆ˜ ìˆëŠ” URLì„ ì…ë ¥í•˜ì.

localì— ì„¤ì¹˜í–ˆë‹¤ë©´ ddnsë‚˜ í¬íŠ¸í¬ì›Œë”© ì„¤ì •ì„ ë§ˆì¹˜ë©´ ì™¸ë¶€ì—ì„œ ì ‘ì†í•  ìˆ˜ ìˆê²Œ ëœë‹¤. ì„¤ì •ì„ í•´ë‹¹ í¬ìŠ¤íŠ¸ì˜ ë²”ìœ„ë¥¼ ë„˜ì–´ê°€ë¯€ë¡œ ì„¤ì •í–ˆë‹¤ê³  ê°€ì •í•˜ê³  ì§„í–‰í•˜ê² ë‹¤.

ê·¸ë¦¬ê³  ë§Œë“¤ì–´ì¤€ admin ê³„ì •ìœ¼ë¡œ ì ‘ì†í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ í™”ë©´ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

![](https://i.imgur.com/cn7XK5u.png){:.align-center}

ì´ë¡œì¨ Jenkinë¥¼ Docker Containerë¡œ ë„ìš°ê³  ì‹¤í–‰í•˜ëŠ” ê³¼ì •ì„ ë§ˆì³¤ë‹¤.